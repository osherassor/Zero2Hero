# ü¶† Malware Analysis

## üîç Introduction to Malware Analysis
- **What is malware?**
- **Types of malware:**
  - Virus  
  - Worm  
  - Trojan  
  - Ransomware  
  - Spyware  
  - Rootkits  
  - Keyloggers  
  - Fileless malware  
- **Malware lifecycle and objectives**
- **Common infection vectors:** phishing, drive-by download, infected USB devices

---

## üß™ Types of Malware Analysis

### üîπ Static Analysis
- Hashing: MD5, SHA1, SHA256  
- File type and structure: PE, ELF, APK, DOCX  
- String extraction tools: `strings`, [FLOSS](https://github.com/mandiant/flare-floss)  
- Disassembly tools: [IDA Pro](https://hex-rays.com/ida-pro/), [Ghidra](https://ghidra-sre.org/), [Radare2](https://rada.re/n/)  
- YARA rule creation  
- Detecting packers/obfuscators: [PEiD](https://www.aldeid.com/wiki/PEiD), [Detect It Easy](https://ntinfo.biz/index.html)

### üîπ Dynamic Analysis
- Behavior monitoring: [Cuckoo](https://cuckoosandbox.org/), [Any.Run](https://any.run/), [Joe Sandbox](https://www.joesecurity.org/)  
- Process injection, API hooks  
- Network communication  
- Registry and file system modification  
- API monitoring: [ProcMon](https://learn.microsoft.com/en-us/sysinternals/downloads/procmon), [API Monitor](http://www.rohitab.com/apimonitor)

### üîπ Hybrid Analysis
- Combine static + dynamic results  
- Sandbox automation and correlation  
- Example platform: [Hybrid Analysis](https://www.hybrid-analysis.com/)

---

## üõ† Malware Analysis Lab Setup
- Use **air-gapped or isolated VMs**  
- Recommended setup:
  - Windows XP / 7 / 10 VM  
  - Linux analysis VM  
  - Tools: x64dbg, Wireshark, Procmon, Process Hacker, Autoruns  
- Use snapshots and rollback functionality  
- Simulate internet access: [INetSim](https://www.inetsim.org/), [FakeNet-NG](https://github.com/mandiant/flare-fakenet-ng)  
- DNS redirection and traffic capture setup  

---

## üß¨ Executable Formats & Internals

### Windows PE Format
- Sections: `.text`, `.rdata`, `.rsrc`  
- Import Address Table (IAT), Export Table  
- Entry point analysis  
- Packing indicators and anomalies  

### Linux ELF Format
- Headers and segment structure  

### Android APK Format
- AndroidManifest.xml  
- Classes.dex and resources  

---

## üß† Behavioral Analysis Techniques
- Registry changes: [Autoruns](https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns), [Regshot](https://sourceforge.net/projects/regshot/)  
- File system: Procmon, Filemon  
- Process/thread: Process Explorer, Process Hacker  
- Network: Wireshark, TCPView  
- Detecting mutexes, named pipes  

---

## üïµÔ∏è Reverse Engineering for Malware
- Recognizing standard routines and string decryption  
- API calls via `Kernel32.dll`, `Ntdll.dll`, etc.  
- Control flow graphs  
- Deobfuscation strategies and shellcode handling  
- Anti-debugging: IsDebuggerPresent, timing tricks, etc.  

---

## üß± Persistence & Evasion Techniques
- Persistence:
  - Startup folder, Run keys, Scheduled Tasks  
  - Registry-based persistence  
- Evasion:
  - DLL injection, Process hollowing  
  - Reflective DLL loading  
  - UAC bypass, LOLBins (Living Off the Land Binaries)  
  - AV/EDR evasion: encryption, packers  

---

## üåê Command and Control (C2)
- Beaconing behavior (timing, jitter, sleep cycles)  
- Protocols: HTTP(S), DNS, ICMP, TCP, custom binary  
- C2 domain decoding, base64 obfuscation  
- DGA (Domain Generation Algorithms) analysis  
- Hardcoded IP detection  

---

## üß∞ Advanced Tools and Techniques
- Disassemblers: [IDA Pro](https://hex-rays.com/ida-pro/), [Ghidra](https://ghidra-sre.org/), [Binary Ninja](https://binary.ninja/)  
- Dynamic instrumentation: [Frida](https://frida.re/), [Intel Pin](https://software.intel.com/content/www/us/en/develop/articles/pin-a-dynamic-binary-instrumentation-tool.html)  
- Emulators and sandboxing tools  
- Debugging packed binaries  
- Heuristic-based detection engines  

---

## üìã Deliverables and Reporting
- Malware family classification and naming  
- IOCs (Indicators of Compromise): Hashes, Domains, IPs, Mutexes  
- Summary of malware behavior and capabilities  
- Mapping TTPs to [MITRE ATT&CK](https://attack.mitre.org/)  
- Screenshots of execution behavior and traffic  
- Mitigation recommendations and recovery actions  
